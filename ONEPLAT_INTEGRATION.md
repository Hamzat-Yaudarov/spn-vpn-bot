# üéØ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è 1Plat (–ö–∞—Ä—Ç–∞/–°–ë–ü)

## –ß—Ç–æ —ç—Ç–æ?

1Plat ‚Äî —Å–µ—Ä–≤–∏—Å –¥–ª—è –ø—Ä–∏—ë–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ –±–∞–Ω–∫–æ–≤—Å–∫–∏–º –∫–∞—Ä—Ç–∞–º –∏ —Å–∏—Å—Ç–µ–º–µ –±—ã—Å—Ç—Ä—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π (–°–ë–ü). –ó–∞–º–µ–Ω–∏–ª Yookassa.

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –í—ã–±–∏—Ä–∞–µ—Ç "1Plat (–ö–∞—Ä—Ç–∞/–°–ë–ü)" ‚Üí –ù–∞–∂–∏–º–∞–µ—Ç "–û–ø–ª–∞—Ç–∏—Ç—å –∫–∞—Ä—Ç–æ–π/–°–ë–ü"
                                               ‚Üì
                                    –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∞ 1Plat
                                               ‚Üì
                                    –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —Ä–µ–∫–≤–∏–∑–∏—Ç—ã
                                               ‚Üì
                                    1Plat –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç—ë–∂
                                               ‚Üì
                                    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–ª–ª–±–µ–∫ –±–æ—Ç—É
                                               ‚Üì
                                    –ë–æ—Ç –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É ‚úÖ
```

## –°—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–∞ –≤ 1Plat

- **0** ‚Äî –ü–ª–∞—Ç–µ–∂ –æ–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã
- **1** ‚Äî –ü–ª–∞—Ç–µ–∂ –æ–ø–ª–∞—á–µ–Ω, –æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –º–µ—Ä—á–∞–Ω—Ç–æ–º
- **2** ‚Äî –ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω (—Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ 1Plat

1. –ó–∞–π–¥–∏ –Ω–∞ https://1plat.cash
2. –°–æ–∑–¥–∞–π –∞–∫–∫–∞—É–Ω—Ç –º–∞–≥–∞–∑–∏–Ω–∞
3. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –Ω–∞–π–¥–∏:
   - **Shop ID** (ID –º–∞–≥–∞–∑–∏–Ω–∞)
   - **Shop Secret** (–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á)
4. –°–∫–æ–ø–∏—Ä—É–π —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å .env –Ω–∞ VPS

```bash
ssh root@YOUR_IP
cd ~/spn-vpn-bot
nano .env
```

–î–æ–±–∞–≤—å –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–π:

```env
# 1Plat Payment
ONEPLAT_SHOP_ID=YOUR_SHOP_ID
ONEPLAT_SHOP_SECRET=YOUR_SHOP_SECRET
ONEPLAT_API_URL=https://1plat.cash
ONEPLAT_WEBHOOK_URL=https://spn.bot.idlebat.online/1plat-webhook
```

–°–æ—Ö—Ä–∞–Ω–∏: Ctrl+O, Enter, Ctrl+X

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–µ–±—Ö—É–∫ –≤ 1Plat –õ–ö

1. –ü–µ—Ä–µ–π–¥–∏ –≤ –õ–ö 1Plat
2. –ù–∞–π–¥–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞ (Settings ‚Üí Webhooks)
3. –£—Å—Ç–∞–Ω–æ–≤–∏ URL –≤–µ–±—Ö—É–∫–∞:
   ```
   https://spn.bot.idlebat.online/1plat-webhook
   ```
4. –í—ã–±–µ—Ä–∏ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–ª–ª–±–µ–∫–æ–≤:
   - Payment status changed (–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞)
5. –°–æ—Ö—Ä–∞–Ω–∏

### –®–∞–≥ 4: –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –¥–æ–º–µ–Ω

1Plat —Ç—Ä–µ–±—É–µ—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–æ–º–µ–Ω–∞. –í—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ –º–µ—Ç–æ–¥–æ–≤:

#### –°–ø–æ—Å–æ–± 1: TXT –∑–∞–ø–∏—Å—å (DNS)
```
–î–æ–º–µ–Ω: spn.bot.idlebat.online
–¢–∏–ø: TXT
–ó–Ω–∞—á–µ–Ω–∏–µ: 1plat:YOUR_SHOP_ID
```

#### –°–ø–æ—Å–æ–± 2: –§–∞–π–ª 1plat.txt
–ü–æ–ª–æ–∂–∏ —Ñ–∞–π–ª –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞:
```
–ü—É—Ç—å: /root/spn-vpn-bot/1plat.txt
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ: YOUR_SHOP_ID
```

–§–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ:
```
https://spn.bot.idlebat.online/1plat.txt
```

(–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ñ–∞–π–ª –≤ –∫–æ–Ω—Ñ–∏–≥ –≤–µ–±—Ö—É–∫–∞)

#### –°–ø–æ—Å–æ–± 3: Meta —Ç–µ–≥ HTML
–î–æ–±–∞–≤—å –≤ –ª—é–±—É—é HTML —Å—Ç—Ä–∞–Ω–∏—Ü—É:
```html
<meta name="1plat" content="YOUR_SHOP_ID">
```

### –®–∞–≥ 5: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏ –±–æ—Ç–∞

```bash
sudo systemctl restart spn-bot
```

–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏:

```bash
sudo journalctl -u spn-bot -f
```

–î–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å:
```
Webhook server started for 1Plat callbacks on 0.0.0.0:8080
Bot started polling...
```

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –∫–æ–¥–µ

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞

```python
# handlers/subscription.py - process_pay_1plat()
payment_data = await create_oneplat_payment(
    merchant_order_id="spn_123456_1234567890",
    tg_id=123456,
    amount=100,           # –≤ —Ä—É–±–ª—è—Ö
    tariff_code="1m",
    method="card"         # –∏–ª–∏ "sbp"
)

guid = payment_data.get("guid")
pay_url = payment_data.get("url")
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–ª–ª–±–µ–∫–∞

```
POST /1plat-webhook (webhook_server.py)
‚Üì
verify_callback_signature_v2()  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏
‚Üì
process_oneplat_callback()      # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–ª–ª–±–µ–∫–∞
‚Üì
activate_oneplat_subscription() # –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
```

### 3. –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏

1Plat –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–≤–µ –ø–æ–¥–ø–∏—Å–∏:
- **signature** ‚Äî HMAC-SHA256(JSON payload, secret)
- **signature_v2** ‚Äî MD5(merchantId + amount + shopId + secret)

–ö–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç signature_v2:

```python
def verify_callback_signature_v2(merchant_id, amount, shop_id, shop_secret, signature_v2):
    data = f"{merchant_id}{amount}{shop_id}{shop_secret}"
    expected_sig = hashlib.md5(data.encode()).hexdigest()
    return expected_sig == signature_v2
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚úÖ **–ü–æ–¥–ø–∏—Å–∏ –∫–æ–ª–ª–±–µ–∫–æ–≤** ‚Äî –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ  
‚úÖ **HTTPS** ‚Äî –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ –∑–∞—â–∏—â—ë–Ω–Ω–æ–º—É –∫–∞–Ω–∞–ª—É  
‚úÖ **–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è** ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–Ω–æ–≥–æ –∫–æ–ª–ª–±–µ–∫–∞  
‚úÖ **Headers –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** ‚Äî x-shop –∏ x-secret –∑–∞—â–∏—â–µ–Ω—ã –≤ .env  

## –ö–æ–ª–ª–±–µ–∫ –æ—Ç 1Plat

–ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –∫–æ–ª–ª–±–µ–∫–∞:

```json
{
  "signature": "asdw12asdv212sd",
  "signature_v2": "asfage3greawfa",
  "payment_id": "123",
  "guid": "111111-add6-5b69-2222-725f7099a32f",
  "merchant_id": "543",
  "user_id": "1111",
  "status": 1,
  "amount": 100,
  "amount_to_pay": 100,
  "amount_to_shop": 85,
  "expired": "2025-04-11T14:54:51.187Z"
}
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤

| –°—Ç–∞—Ç—É—Å | –î–µ–π—Å—Ç–≤–∏–µ |
|--------|----------|
| 0 | –ü–ª–∞—Ç—ë–∂ –æ–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã (–Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º) |
| 1 | –ü–ª–∞—Ç–µ–∂ –æ–ø–ª–∞—á–µ–Ω ‚Üí **–ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–¥–ø–∏—Å–∫—É** ‚úÖ |
| 2 | –ü–ª–∞—Ç–µ–∂ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω ‚Üí **–ü–æ–¥–ø–∏—Å–∫–∞ —É–∂–µ –∞–∫—Ç–∏–≤–Ω–∞** |
| -1, -2 | –û—à–∏–±–∫–∞ –ø–ª–∞—Ç–µ–∂–∞ ‚Üí –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É |

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–π ngrok –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è localhost:

```bash
ngrok http 8080
# –ü–æ–ª—É—á–∏—à—å URL —Ç–∏–ø–∞: https://1234-56-789-10-11.ngrok.io
```

–û–±–Ω–æ–≤–∏ –≤–µ–±—Ö—É–∫ –≤ —Ç–µ—Å—Ç–æ–≤–æ–º –º–∞–≥–∞–∑–∏–Ω–µ –Ω–∞ —ç—Ç–æ—Ç URL.

### –¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã 1Plat

–°–≤—è–∂–∏—Å—å —Å —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–æ–π 1Plat –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ä—Ç.

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ö–æ–ª–ª–±–µ–∫ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç

1. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –≤–µ–±—Ö—É–∫ –∑–∞–ø—É—â–µ–Ω: `sudo systemctl status spn-bot`
2. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –ø–æ—Ä—Ç 8080 –æ—Ç–∫—Ä—ã—Ç: `netstat -tlnp | grep 8080`
3. –ü—Ä–æ–≤–µ—Ä—å firewall: `sudo ufw status`
4. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏: `sudo journalctl -u spn-bot -n 50`

### –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞

```
ERROR: 1Plat callback signature verification failed
```

–ü—Ä–æ–≤–µ—Ä—å:
1. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–∏ ONEPLAT_SHOP_SECRET –≤ .env?
2. –°–æ–≤–ø–∞–¥–∞–µ—Ç –ª–∏ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–¥–µ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π 1Plat?

### –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è

```
ERROR: Failed to activate subscription for user 123456
```

–ü—Ä–æ–≤–µ—Ä—å:
1. –ï—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ë–î?
2. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–∏ –∫–æ–¥ —Ç–∞—Ä–∏—Ñ–∞?
3. –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ Remnawave API?

–°–º–æ—Ç—Ä–∏ –ø–æ–ª–Ω—ã–π –ª–æ–≥:
```bash
sudo journalctl -u spn-bot -f | grep "1Plat"
```

## API –º–µ—Ç–æ–¥—ã 1Plat

–í—Å–µ –º–µ—Ç–æ–¥—ã –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ ONEPLAT_INTEGRATION.md:

- `POST /api/merchant/order/create/by-api` ‚Äî –°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç—ë–∂
- `GET /api/merchant/order/info/:guid/by-api` ‚Äî –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞—Ç–µ–∂–µ
- `POST /api/merchant/order/list/by-api` ‚Äî –°–ø–∏—Å–æ–∫ –ø–ª–∞—Ç–µ–∂–µ–π

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: https://1plat.cash (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

## FAQ

**Q: –ü–æ—á–µ–º—É –ø–ª–∞—Ç—ë–∂ —Å—Ç–∞—Ç—É—Å 1, –∞ –Ω–µ 2?**  
A: –ü–ª–∞—Ç—ë–∂ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –º–µ—Ä—á–∞–Ω—Ç–æ–º. –ü–æ—Å–ª–µ –∫–æ–ª–ª–±–µ–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ 1 –æ–Ω –ø–µ—Ä–µ–π–¥—ë—Ç –≤ 2.

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É –∏ –°–ë–ü –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ?**  
A: –î–∞, 1Plat –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±–µ –æ–ø—Ü–∏–∏ –≤ —Ñ–æ—Ä–º–µ –æ–ø–ª–∞—Ç—ã.

**Q: –ß—Ç–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–æ—à—ë–ª –ø–ª–∞—Ç—ë–∂?**  
A: –ü–ª–∞—Ç—ë–∂ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å–µ 0, –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â—ë —Ä–∞–∑.

**Q: –ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å –±–∞–ª–∞–Ω—Å?**  
A: –í –õ–ö 1Plat ‚Üí –î–∞—à–±–æ—Ä–¥ ‚Üí Balance

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ 1Plat

- Website: https://1plat.cash
- Email: support@1plat.cash
- Telegram: https://t.me/oneplat_support
