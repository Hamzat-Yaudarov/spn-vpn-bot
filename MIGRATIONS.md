# üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

## –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ/–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞:
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –Ω–æ–≤—ã–µ —Å—Ç–æ–ª–±—Ü—ã –≤ –ë–î  
‚úÖ –í–∞–º –Ω–µ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –≤—Ä—É—á–Ω—É—é –≤—ã–ø–æ–ª–Ω—è—Ç—å SQL –≤ Supabase  
‚úÖ –ï—Å–ª–∏ —Å—Ç–æ–ª–±—Ü—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç - –æ–Ω–∏ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è  

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—Å–∫–∞:

```
1. –ë–æ—Ç —Å—Ç–∞—Ä—Ç—É–µ—Ç
   ‚Üì
2. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Supabase
   ‚Üì
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é run_migrations()
   ‚Üì
4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∫–∏–µ —Å—Ç–æ–ª–±—Ü—ã –Ω—É–∂–Ω—ã
   ‚Üì
5. –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Å—Ç–æ–ª–±—Ü—ã (–µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç)
   ‚Üì
6. –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
   ‚Üì
7. –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ! ‚úÖ
```

### –ü—Ä–∏–º–µ—Ä –ª–æ–≥–æ–≤ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:

```
Database pool initialized successfully
Running migrations...
Migration executed: ALTER TABLE users ADD COLUMN IF NOT EXISTS last_gift_attempt TIMESTAMP;
Migration executed: ALTER TABLE users ADD COLUMN IF NOT EXISTS last_promo_attempt TIMESTAMP;
Migration executed: ALTER TABLE users ADD COLUMN IF NOT EXISTS last_payment_check TIMESTAMP;
All migrations completed successfully ‚úÖ
Bot started polling...
```

---

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤ –∫–æ–¥–µ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π?

### 1Ô∏è‚É£ –ï—Å–ª–∏ –¥–æ–±–∞–≤–ª—è–µ—à—å –Ω–æ–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü –≤ —Ç–∞–±–ª–∏—Ü—É

**–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π `database.py`**, –Ω–∞–π–¥–∏ —Ñ—É–Ω–∫—Ü–∏—é `run_migrations()` –∏ –¥–æ–±–∞–≤—å —Å—Ç—Ä–æ–∫—É:

```python
migration_queries = [
    "ALTER TABLE users ADD COLUMN IF NOT EXISTS last_gift_attempt TIMESTAMP;",
    "ALTER TABLE users ADD COLUMN IF NOT EXISTS last_promo_attempt TIMESTAMP;",
    "ALTER TABLE users ADD COLUMN IF NOT EXISTS last_payment_check TIMESTAMP;",
    # üëá –î–û–ë–ê–í–¨ –°–Æ–î–ê –ù–û–í–´–ô –°–¢–û–õ–ë–ï–¶
    "ALTER TABLE users ADD COLUMN IF NOT EXISTS new_column_name DATA_TYPE;",
]
```

### 2Ô∏è‚É£ –ï—Å–ª–∏ —Å–æ–∑–¥–∞—ë—à—å –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É

–î–æ–±–∞–≤—å –≤ `run_migrations()`:

```python
# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
await conn.execute("""
    CREATE TABLE IF NOT EXISTS new_table (
        id SERIAL PRIMARY KEY,
        name TEXT NOT NULL,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    );
""")
```

### 3Ô∏è‚É£ –ï—Å–ª–∏ –¥–æ–±–∞–≤–ª—è–µ—à—å –∏–Ω–¥–µ–∫—Å

–î–æ–±–∞–≤—å –≤ `run_migrations()`:

```python
await conn.execute("""
    CREATE INDEX IF NOT EXISTS idx_new_table_name ON new_table(name);
""")
```

---

## –ü–æ—á–µ–º—É —ç—Ç–æ —Ö–æ—Ä–æ—à–æ?

| –ë—ã–ª–æ –¥–æ | –°—Ç–∞–ª–æ —Å–µ–π—á–∞—Å |
|--------|-------------|
| ‚ùå –ù—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –æ—Ç–∫—Ä—ã–≤–∞—Ç—å Supabase | ‚úÖ –í—Å—ë –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ |
| ‚ùå –ù—É–∂–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å SQL –∫–æ–¥ | ‚úÖ –í—Å—ë –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ |
| ‚ùå –ú–æ–∂–Ω–æ –∑–∞–±—ã—Ç—å –æ–±–Ω–æ–≤–∏—Ç—å –ë–î | ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–±—ã—Ç—å |
| ‚ùå –ü—Ä–æ—Å—Ç–æ–∏ –ø—Ä–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ | ‚úÖ –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –≤—Å–µ –æ—à–∏–±–∫–∏ |
| ‚ùå –†–∞–∑–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è = —Ä–∞–∑–Ω—ã–µ —Å—Ö–µ–º—ã | ‚úÖ –í—Å–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã |

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –ø–æ—Å–º–æ—Ç—Ä–∏ –ª–æ–≥–∏:

```bash
sudo journalctl -u spn-bot -f
```

–î–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å —Ç–∞–∫–∏–µ —Å—Ç—Ä–æ–∫–∏ (–±–µ–∑ –∫—Ä–∞—Å–Ω—ã—Ö –æ—à–∏–±–æ–∫):
```
Database pool initialized successfully
Running migrations...
Migration executed: ALTER TABLE users ADD COLUMN IF NOT EXISTS last_gift_attempt TIMESTAMP;
All migrations completed successfully ‚úÖ
```

---

## –í–∞–∂–Ω–æ–µ!

‚ö†Ô∏è **–£–î–ê–õ–Ø–ô –°–¢–†–û–ö–£ –∏–∑ schema.sql –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–∞** - —Ç–µ–ø–µ—Ä—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ –∫–æ–¥–µ!

```sql
-- ‚ùå –≠–¢–û–¢ SQL –ë–û–õ–¨–®–ï –ù–ï –ù–£–ñ–ù–û –ó–ê–ü–£–°–ö–ê–¢–¨ –í–†–£–ß–ù–£–Æ
-- ALTER TABLE users ADD COLUMN IF NOT EXISTS last_gift_attempt TIMESTAMP;
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚úÖ **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** ‚Äî —Ñ—É–Ω–∫—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–∞ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—É—Å–∫–µ  
‚úÖ **–û—Ç–∫–∞—Ç** ‚Äî –µ—Å–ª–∏ –æ—à–∏–±–∫–∞, —Ç–∞–±–ª–∏—Ü–∞ –Ω–µ –∏—Å–ø–æ—Ä—Ç–∏—Ç—Å—è  
‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –ª–æ–≥–∏  
‚úÖ **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** ‚Äî –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–∏–±–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è, –ª–∏–±–æ –æ—Ç–∫–∞—Ç—ã–≤–∞—é—Ç—Å—è  

---

## –ü—Ä–æ–±–ª–µ–º—ã?

–ï—Å–ª–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –≤–∏–¥–∏—à—å –æ—à–∏–±–∫—É –≤ –ª–æ–≥–∞—Ö - –ø—Ä–æ–≤–µ—Ä—å:

1. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–∏ `DATABASE_URL` –≤ `.env`?
2. IP VPS –¥–æ–±–∞–≤–ª–µ–Ω –≤ firewall Supabase?
3. –°–∏–Ω—Ç–∞–∫—Å–∏—Å SQL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π?

–í—Å–µ –æ—à–∏–±–∫–∏ –±—É–¥—É—Ç –≤–∏–¥–Ω—ã –≤ –ª–æ–≥–∞—Ö:
```bash
sudo journalctl -u spn-bot -n 50
```
