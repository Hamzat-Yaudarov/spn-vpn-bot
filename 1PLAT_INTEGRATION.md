# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è 1Plat –ø–ª–∞—Ç–µ–∂–µ–π

## –û–ø–∏—Å–∞–Ω–∏–µ

–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–ø–ª–∞—Ç—É –ø–æ–¥–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ –ø–ª–∞—Ç–µ–∂–Ω—É—é —Å–∏—Å—Ç–µ–º—É 1Plat. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ–ø–ª–∞—á–∏–≤–∞—Ç—å —á–µ—Ä–µ–∑:
- üí≥ –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –∫–∞—Ä—Ç—ã (VISA, MasterCard, –ú–ò–†)
- üì± –°–ë–ü (—Å–∏—Å—Ç–µ–º–∞ –±—ã—Å—Ç—Ä—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞)

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–∞—Ä–∏—Ñ –ø–æ–¥–ø–∏—Å–∫–∏
2. –í—ã–±–∏—Ä–∞–µ—Ç —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã: –∫–∞—Ä—Ç–∞ –∏–ª–∏ –°–ë–ü
3. –ë–æ—Ç —Å–æ–∑–¥–∞—ë—Ç –ø–ª–∞—Ç–µ–∂ —á–µ—Ä–µ–∑ API 1Plat (`POST /api/merchant/order/create/by-api`)
4. –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∫–≤–∏–∑–∏—Ç—ã (–Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã, –±–∞–Ω–∫, –§–ò–û –ø–æ–ª—É—á–∞—Ç–µ–ª—è)
5. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç –ø–ª–∞—Ç—ë–∂
7. **–í–ê–ñ–ù–û:** 1Plat –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç callback –Ω–∞ webhook `https://spn.bot.idlebat.online/1plat-webhook`
8. –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è callback'–∞ —Å —Å—Ç–∞—Ç—É—Å–æ–º "–æ–ø–ª–∞—á–µ–Ω–æ" –∏–ª–∏ "–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ" - –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è

## –°—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–µ–π 1Plat

| –°—Ç–∞—Ç—É—Å | –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-----|---------|
| –û—à–∏–±–∫–∞ | -2 | –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–∏—Å–∞–Ω–∏–∏ —Å—á–µ—Ç–∞ |
| –ß–µ—Ä–Ω–æ–≤–∏–∫ | -1 | –û–∂–∏–¥–∞–µ—Ç –≤—ã–±–æ—Ä–∞ –º–µ—Ç–æ–¥–∞ –æ–ø–ª–∞—Ç—ã |
| –û–∂–∏–¥–∞–µ—Ç | 0 | –ü–ª–∞—Ç–µ–∂ –æ–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã |
| –û–ø–ª–∞—á–µ–Ω | 1 | –ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–Ω–æ –æ–ø–ª–∞—á–µ–Ω (–æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –º–µ—Ä—á–∞–Ω—Ç–æ–º) |
| –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω | 2 | –ü–ª–∞—Ç–µ–∂ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω –º–µ—Ä—á–∞–Ω—Ç–æ–º –∏ –∑–∞–∫—Ä—ã—Ç |

–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ç—É—Å–µ 1 –∏–ª–∏ 2.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–æ–ª—É—á–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω–∞

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://1plat.cash (–∏–ª–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –≤–∞—à–µ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞)
2. –ù–∞–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ (–õ–ö):
   - **x-shop** (Shop ID) - ID –≤–∞—à–µ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞
   - **x-secret** (Secret Key) - –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –º–∞–≥–∞–∑–∏–Ω–∞
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env` —Ñ–∞–π–ª:

```env
ONEPLAT_SHOP_ID=your_shop_id
ONEPLAT_SHOP_SECRET=your_shop_secret
ONEPLAT_BASE_URL=https://1plat.cash
ONEPLAT_CALLBACK_URL=https://spn.bot.idlebat.online/1plat-webhook
```

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ callback URL –≤ 1Plat

1. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –º–∞–≥–∞–∑–∏–Ω–∞ 1Plat —É–∫–∞–∂–∏—Ç–µ URL –¥–ª—è callback'–æ–≤:
   ```
   https://spn.bot.idlebat.online/1plat-webhook
   ```
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–µ–±—Ö—É–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç (1Plat –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å POST –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —ç—Ç–æ—Ç URL)

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–æ–º–µ–Ω–∞

1Plat —Ç—Ä–µ–±—É–µ—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–æ–º–µ–Ω–∞. –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –º–µ—Ç–æ–¥–æ–≤:

#### –ú–µ—Ç–æ–¥ 1: TXT –∑–∞–ø–∏—Å—å
–î–æ–±–∞–≤—å—Ç–µ TXT-–∑–∞–ø–∏—Å—å –¥–ª—è –¥–æ–º–µ–Ω–∞ `spn.bot.idlebat.online`:
```
3600 IN TXT "1plat:SHOP_ID"
```
–ó–∞–º–µ–Ω–∏—Ç–µ `SHOP_ID` –Ω–∞ –≤–∞—à ID –º–∞–≥–∞–∑–∏–Ω–∞.

#### –ú–µ—Ç–æ–¥ 2: –§–∞–π–ª –≤ –∫–æ—Ä–Ω–µ
–ü–æ–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª `1plat.txt` –≤ –∫–æ—Ä–µ–Ω—å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:
```
SHOP_ID
```
–§–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:
```
https://spn.bot.idlebat.online/1plat.txt
```

#### –ú–µ—Ç–æ–¥ 3: Meta —Ç–µ–≥
–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –¥–æ–±–∞–≤—å—Ç–µ –≤ `<head>`:
```html
<meta name="1plat" content="SHOP_ID">
```

### 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç

```bash
python main.py
```

–ë–æ—Ç –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å:
- Telegram polling –Ω–∞ –ø–æ—Ä—Ç–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- Webhook —Å–µ—Ä–≤–µ—Ä (Quart) –Ω–∞ –ø–æ—Ä—Ç–µ **8080** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è callback'–æ–≤ –æ—Ç 1Plat

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Telegram                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ –í—ã–±–∏—Ä–∞–µ—Ç –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ 1Plat
            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Telegram Bot (Aiogram)                                  ‚îÇ
‚îÇ - handlers/subscription.py:process_pay_1plat()         ‚îÇ
‚îÇ   + –í—ã–∑—ã–≤–∞–µ—Ç services/oneplat.py:create_oneplat_payment‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ API –∑–∞–ø—Ä–æ—Å —Å x-shop –∏ x-secret
            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1Plat API (https://1plat.cash)                         ‚îÇ
‚îÇ POST /api/merchant/order/create/by-api                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç GUID –ø–ª–∞—Ç–µ–∂–∞ –∏ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã
            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Telegram Bot                                            ‚îÇ
‚îÇ - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é                    ‚îÇ
‚îÇ - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–ª–∞—Ç–µ–∂ –≤ –ë–î (PostgreSQL)                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

            === –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –û–ü–õ–ê–ß–ò–í–ê–ï–¢ –ü–õ–ê–¢–Å–ñ ===

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1Plat –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç callback –Ω–∞ webhook                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ POST https://spn.bot.idlebat.online/1plat-webhook
            ‚îÇ Body: {guid, status, signature, ...}
            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Quart Webhook Server (–ø–æ—Ä—Ç 8080)                       ‚îÇ
‚îÇ - handlers/webhooks.py:handle_oneplat_webhook()        ‚îÇ
‚îÇ   + –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å callback'–∞                       ‚îÇ
‚îÇ   + –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ (1 –∏–ª–∏ 2 = –æ–ø–ª–∞—á–µ–Ω–æ)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å = –æ–ø–ª–∞—á–µ–Ω–æ
            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Telegram Bot                                            ‚îÇ
‚îÇ - services/cryptobot.py:process_paid_invoice()         ‚îÇ
‚îÇ   + –°–æ–∑–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Remnawave (VPN API)        ‚îÇ
‚îÇ   + –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É                                ‚îÇ
‚îÇ   + –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É                 ‚îÇ
‚îÇ - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å —Å—Å—ã–ª–∫–æ–π         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–µ–π

### –ú–µ—Ç–æ–¥—ã –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

1Plat –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ –º–µ—Ç–æ–¥–∞ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è callback'–æ–≤:

#### –ú–µ—Ç–æ–¥ 1: HMAC-SHA256
```python
signature = HMAC-SHA256(JSON.stringify(body.payload), shopSecret)
```

#### –ú–µ—Ç–æ–¥ 2: MD5
```python
signature_v2 = MD5(merchantId + amount + shopId + shopSecret)
```

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –∫–æ–¥–µ

–§—É–Ω–∫—Ü–∏—è `verify_callback()` –≤ `services/oneplat.py` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–±–µ –ø–æ–¥–ø–∏—Å–∏:

```python
def verify_callback(body: Dict[str, Any]) -> bool:
    signature_v1 = body.get("signature", "")
    signature_v2 = body.get("signature_v2", "")
    
    v1_valid = verify_callback_signature(body, signature_v1, use_v2=False)
    v2_valid = verify_callback_signature(body, signature_v2, use_v2=True)
    
    return v1_valid or v2_valid
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è webhook'–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok
brew install ngrok  # macOS
# –∏–ª–∏ –¥–ª—è Linux: https://ngrok.com/download

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ ngrok
ngrok http 8080

# –í—ã –ø–æ–ª—É—á–∏—Ç–µ URL –≤—Ä–æ–¥–µ: https://xxx-xxx-xxx.ngrok.io
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —ç—Ç–æ—Ç URL + /1plat-webhook –≤ –∫–∞—á–µ—Å—Ç–≤–µ callback URL –≤ 1Plat –õ–ö
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
tail -f bot.log | grep "1plat"
```

## API Endpoints 1Plat

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
```
POST /api/merchant/order/create/by-api
Headers:
  x-shop: SHOP_ID
  x-secret: SHOP_SECRET
Body:
{
  "merchant_order_id": "spn_USER_ID_TARIFF_TIMESTAMP",
  "user_id": USER_ID,
  "amount": 100,
  "method": "card" | "sbp",
  "currency": "RUB",
  "email": "USER_ID@spn.local"
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–ª–∞—Ç–µ–∂–µ
```
GET /api/merchant/order/info/{guid}/by-api
Headers:
  x-shop: SHOP_ID
  x-secret: SHOP_SECRET
```

### Webhook callback
```
POST /1plat-webhook (–Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ)
Body:
{
  "signature": "...",
  "signature_v2": "...",
  "guid": "...",
  "payment_id": 123,
  "merchant_id": "...",
  "user_id": TG_ID,
  "status": 1 | 2,
  "amount": 100,
  "amount_to_pay": 100,
  "amount_to_shop": 85,
  "expired": "2025-04-11T14:54:51.187Z",
  ...
}
```

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Webhook –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç callback'–∏

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–æ–º–µ–Ω –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω –≤ 1Plat
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ callback URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö 1Plat
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞: `grep "1plat" bot.log`
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ù–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å callback'–∞

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ ONEPLAT_SHOP_SECRET –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ—Ä—Å–∏—è 1.0 API (–Ω–µ legacy)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç JSON –≤ callback'–µ

### –ü–ª–∞—Ç–µ–∂ —Å–æ–∑–¥–∞—ë—Ç—Å—è, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç —Ä–µ–∫–≤–∏–∑–∏—Ç—ã

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ API –∑–∞–ø—Ä–æ—Å —É—Å–ø–µ—à–µ–Ω (—Å—Ç–∞—Ç—É—Å 200)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –æ—Ç–≤–µ—Ç–µ –µ—Å—Ç—å –ø–æ–ª–µ `note` —Å —Ä–µ–∫–≤–∏–∑–∏—Ç–∞–º–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `grep "create_oneplat_payment" bot.log`

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏

- **1Plat –ø–æ–¥–¥–µ—Ä–∂–∫–∞:** https://1plat.cash (–≤ –õ–ö)
- **–ù–∞—à–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞:** [Telegram —Å—Å—ã–ª–∫–∞ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞]

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è 1Plat API](https://1plat.cash/api)
- [–ö–æ–¥—ã –æ—à–∏–±–æ–∫ 1Plat](#)
- [–°–ø–∏—Å–æ–∫ –±–∞–Ω–∫–æ–≤ –¥–ª—è –°–ë–ü](https://1plat.cash/banks)
