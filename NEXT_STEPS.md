# üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ 1Plat –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## üìã –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ —á—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

‚úÖ **–ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è 1Plat –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã**

–í–º–µ—Å—Ç–æ –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è Yookassa —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–ø–ª–∞—Ç—ã:
- üí≥ –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –∫–∞—Ä—Ç—ã (VISA, MasterCard, –ú–ò–†)
- üì± –°–ë–ü (–ø–ª–∞—Ç–µ–∂–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
- üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–µ–π callback'–æ–≤
- üåê Webhook —Å–µ—Ä–≤–µ—Ä –Ω–∞ Quart (–ø–æ—Ä—Ç 8080)

---

## üìÅ –ß—Ç–æ –±—ã–ª–æ —Å–æ–∑–¥–∞–Ω–æ/–∏–∑–º–µ–Ω–µ–Ω–æ

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã (5)
```
‚ú® services/oneplat.py              (196 —Å—Ç—Ä–æ–∫) - API 1Plat
‚ú® handlers/webhooks.py             (119 —Å—Ç—Ä–æ–∫) - Webhook endpoint
‚ú® 1PLAT_INTEGRATION.md            (284 —Å—Ç—Ä–æ–∫–∏) - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚ú® ONEPLAT_DEPLOYMENT.md           (445 —Å—Ç—Ä–æ–∫) - –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ
‚ú® test_1plat_webhook.py           (168 —Å—Ç—Ä–æ–∫) - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```

### –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (8)
```
‚úèÔ∏è handlers/subscription.py         (+100 —Å—Ç—Ä–æ–∫) - –ó–∞–º–µ–Ω–∞ Yookassa –Ω–∞ 1Plat
‚úèÔ∏è config.py                        (+4 —Å—Ç—Ä–æ–∫–∏) - ONEPLAT_* –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
‚úèÔ∏è database.py                      (+20 —Å—Ç—Ä–æ–∫) - –ú–∏–≥—Ä–∞—Ü–∏—è –∏ —Ñ—É–Ω–∫—Ü–∏–∏
‚úèÔ∏è states.py                        (+1 —Å–æ—Å—Ç–æ—è–Ω–∏–µ) - choosing_1plat_method
‚úèÔ∏è main.py                          (Quart —Å–µ—Ä–≤–µ—Ä) - Webhook –ø–æ–¥–¥–µ—Ä–∂–∫–∞
‚úèÔ∏è services/cryptobot.py            (–û–±–Ω–æ–≤–ª–µ–Ω–∞) - –†–∞–±–æ—Ç–∞–µ—Ç —Å –æ–±–æ–∏–º–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏
‚úèÔ∏è requirements.txt                 (+quart) - –ù–æ–≤–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
‚úèÔ∏è .env.example                     (+4 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ) - 1Plat –∫–æ–Ω—Ñ–∏–≥
```

### –ò—Ç–æ–≥–æ
- **–ù–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤:** 5
- **–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:** 8
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** ~1200+

---

## üéØ –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### ‚úÖ –≠—Ç–∞–ø 1: –ì–æ—Ç–æ–≤–æ –≤ code (–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ)

- [x] –°–æ–∑–¥–∞–Ω —Å–µ—Ä–≤–∏—Å 1Plat
- [x] –°–æ–∑–¥–∞–Ω webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ë–î (–º–∏–≥—Ä–∞—Ü–∏—è)
- [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π
- [x] –ù–∞–ø–∏—Å–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [x] –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
- [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### ‚è≥ –≠—Ç–∞–ø 2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ 1Plat (–ø–µ—Ä–µ–¥ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ–º)

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. **–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω–∞ –æ—Ç 1Plat**
   - –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ https://1plat.cash (–∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å)
   - –ù–∞–π—Ç–∏ **Shop ID** (ID –º–∞–≥–∞–∑–∏–Ω–∞)
   - –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å **Shop Secret** (—Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á)
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º–∞–≥–∞–∑–∏–Ω –∞–∫—Ç–∏–≤–µ–Ω

2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å callback URL –≤ 1Plat –õ–ö**
   - –ü–µ—Ä–µ–π—Ç–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å callback URL:
     ```
     https://spn.bot.idlebat.online/1plat-webhook
     ```
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

3. **–í—ã–±—Ä–∞—Ç—å —Å–ø–æ—Å–æ–± –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–æ–º–µ–Ω–∞**
   - –ú–µ—Ç–æ–¥ 1: TXT –∑–∞–ø–∏—Å—å (—Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π)
     ```
     spn.bot.idlebat.online TXT "1plat:YOUR_SHOP_ID"
     ```
   - –ú–µ—Ç–æ–¥ 2: –§–∞–π–ª `1plat.txt` –≤ –∫–æ—Ä–Ω–µ (–≥–æ—Ç–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ)
   - –ú–µ—Ç–æ–¥ 3: Meta —Ç–µ–≥ (–µ—Å–ª–∏ –µ—Å—Ç—å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)

### ‚è≥ –≠—Ç–∞–ø 3: –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–í—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ 77.233.214.150:**

```bash
# 1. SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
ssh root@77.233.214.150

# 2. –ù–∞–≤–∏–≥–∞—Ü–∏—è
cd /opt

# 3. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone https://github.com/Hamzat-Yaudarov/spn-vpn-bot.git
cd spn-vpn-bot

# 4. –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python3.10 -m venv venv
source venv/bin/activate

# 5. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# 6. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ .env
cp .env.example .env
nano .env

# –ó–∞–ø–æ–ª–Ω–∏—Ç—å (–º–∏–Ω–∏–º—É–º):
# - BOT_TOKEN (Telegram —Ç–æ–∫–µ–Ω)
# - DATABASE_URL (Supabase PostgreSQL)
# - REMNAWAVE_* (VPN API)
# - ONEPLAT_SHOP_ID (–∏–∑ 1Plat –õ–ö)
# - ONEPLAT_SHOP_SECRET (–∏–∑ 1Plat –õ–ö)
# - ONEPLAT_CALLBACK_URL=https://spn.bot.idlebat.online/1plat-webhook

# 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
python -c "import asyncio; from database import init_db; asyncio.run(init_db())"

# 8. –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫
python main.py

# –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ "Bot started polling..." –∏ "Webhook server started..."
# - –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç! Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏

# 9. Nginx –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è webhook'–æ–≤
sudo nano /etc/nginx/sites-available/spn.bot.idlebat.online
# –î–æ–±–∞–≤–∏—Ç—å:
# location /1plat-webhook {
#     proxy_pass http://localhost:8080;
# }

# 10. Systemd —Å–µ—Ä–≤–∏—Å (–∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞)
sudo nano /etc/systemd/system/spn-bot.service
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ ONEPLAT_DEPLOYMENT.md

sudo systemctl daemon-reload
sudo systemctl enable spn-bot
sudo systemctl start spn-bot

# 11. –ü—Ä–æ–≤–µ—Ä–∫–∞
sudo systemctl status spn-bot
sudo journalctl -u spn-bot -f | grep -i 1plat
```

### ‚è≥ –≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–õ–æ–∫–∞–ª—å–Ω–æ (–ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ):**

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç
python main.py

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π callback
python test_1plat_webhook.py 1    # –°—Ç–∞—Ç—É—Å "–æ–ø–ª–∞—á–µ–Ω–æ"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "Payment processed successfully"
```

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

1. –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É `/start`
2. –ù–∞–∂–∏–º–∞–µ—Ç–µ "–û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É"
3. –í—ã–±–∏—Ä–∞–µ—Ç–µ —Ç–∞—Ä–∏—Ñ
4. –í—ã–±–∏—Ä–∞–µ—Ç–µ "Yookassa" (—Ç–µ–ø–µ—Ä—å —ç—Ç–æ 1Plat)
5. –í—ã–±–∏—Ä–∞–µ—Ç–µ "–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞" –∏–ª–∏ "–°–ë–ü"
6. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç–µ, —á—Ç–æ –≤–∏–¥–Ω—ã —Ä–µ–∫–≤–∏–∑–∏—Ç—ã
7. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç–µ –≤ –ª–æ–≥–∞—Ö: `sudo journalctl -u spn-bot -f`

### ‚è≥ –≠—Ç–∞–ø 5: Live —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –ø–ª–∞—Ç–µ–∂:

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–∞–≥–∞–∑–∏–Ω –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –≤ 1Plat
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ callback URL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–ª–∞—Ç—ë–∂ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
4. –î–æ–∂–¥–∏—Ç–µ—Å—å callback'–∞ (–æ–±—ã—á–Ω–æ <1 —Å–µ–∫—É–Ω–¥—ã)
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ª–æ–≥–∞—Ö, —á—Ç–æ –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ

1. **[INTEGRATION_SUMMARY.md](INTEGRATION_SUMMARY.md)** ‚Üê –ù–∞—á–Ω–∏—Ç–µ –æ—Ç—Å—é–¥–∞!
   - –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (–¥–∏–∞–≥—Ä–∞–º–º–∞)
   - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

2. **[1PLAT_INTEGRATION.md](1PLAT_INTEGRATION.md)** ‚Üê –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
   - –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ 1Plat API
   - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–µ–π
   - –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

3. **[ONEPLAT_DEPLOYMENT.md](ONEPLAT_DEPLOYMENT.md)** ‚Üê –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
   - Nginx –∫–æ–Ω—Ñ–∏–≥
   - SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
   - Systemd —Å–µ—Ä–≤–∏—Å
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –°–ø—Ä–∞–≤–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- **[CHANGES.md](CHANGES.md)** - –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **[README.md](README.md)** - –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- **[test_1plat_webhook.py](test_1plat_webhook.py)** - –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è 1Plat

–î–æ–±–∞–≤–∏—Ç—å –≤ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```env
# –ò–∑ 1Plat –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
ONEPLAT_SHOP_ID=12345
ONEPLAT_SHOP_SECRET=your_secret_key_from_1plat_lk

# API URL 1Plat (–Ω–µ –º–µ–Ω—è—Ç—å)
ONEPLAT_BASE_URL=https://1plat.cash

# Callback URL (—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ 1Plat –õ–ö)
ONEPLAT_CALLBACK_URL=https://spn.bot.idlebat.online/1plat-webhook
```

### –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–¥–æ–ª–∂–Ω—ã —É–∂–µ –±—ã—Ç—å)

```env
# Telegram Bot
BOT_TOKEN=your_telegram_token
ADMIN_ID=your_admin_id

# PostgreSQL (Supabase)
DATABASE_URL=postgresql://...
SUPABASE_URL=https://...
SUPABASE_KEY=...

# Remnawave VPN API
REMNAWAVE_BASE_URL=https://...
REMNAWAVE_API_TOKEN=...
DEFAULT_SQUAD_UUID=...

# CryptoBot (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
CRYPTOBOT_TOKEN=...
CRYPTOBOT_API_URL=...
```

---

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram Bot (Aiogram + Quart)         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Port 8080: Quart webhook —Å–µ—Ä–≤–µ—Ä         ‚îÇ
‚îÇ Polling: Telegram API polling           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:                            ‚îÇ
‚îÇ  - handlers/subscription.py ‚Üí –ü–ª–∞—Ç–µ–∂–∏   ‚îÇ
‚îÇ  - handlers/webhooks.py ‚Üí Webhook'–∏     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –°–µ—Ä–≤–∏—Å—ã:                                ‚îÇ
‚îÇ  - services/oneplat.py ‚Üí API 1Plat      ‚îÇ
‚îÇ  - services/cryptobot.py ‚Üí CryptoBot    ‚îÇ
‚îÇ  - services/remnawave.py ‚Üí VPN API      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –•—Ä–∞–Ω–∏–ª–∏—â–µ:                              ‚îÇ
‚îÇ  - PostgreSQL (Supabase)                ‚îÇ
‚îÇ  - Advisory locks –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

        ‚ÜïÔ∏è HTTPS

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  1Plat Payment System                   ‚îÇ
‚îÇ  https://1plat.cash                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üö® –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: "Webhook –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç callback'–∏"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω –ª–∏ –¥–æ–º–µ–Ω –≤ 1Plat –õ–ö
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å callback URL: `https://spn.bot.idlebat.online/1plat-webhook`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Nginx –∫–æ–Ω—Ñ–∏–≥ (–ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç –Ω–∞ 8080?)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `sudo journalctl -u spn-bot -f`

### –ü—Ä–æ–±–ª–µ–º–∞: "Signature verification failed"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `ONEPLAT_SHOP_SECRET` –≤ `.env` (–±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤)
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª—é—á –∏–∑ 1Plat –õ–ö
3. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –ª–æ–≥–∞—Ö —á—Ç–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ callback

### –ü—Ä–æ–±–ª–µ–º–∞: "Payment processed, but subscription not activated"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Remnawave API
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `REMNAWAVE_*` –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–æ–≥–∞—Ö: `sudo journalctl -u spn-bot -f | grep Remnawave`

### –ü—Ä–æ–±–ª–µ–º–∞: "AttributeError: module 'main' has no attribute 'bot'"

**–†–µ—à–µ–Ω–∏–µ:**
- –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–¥–µ! Bot –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ `set_bot()` —Ñ—É–Ω–∫—Ü–∏—é

---

## üìä –°—Ç–∞—Ç—É—Å—ã –∏ –∫–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤

### –ö–æ–¥—ã —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–ª–∞—Ç–µ–∂–µ–π 1Plat

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ |
|-----|---------|---------|
| -2 | –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–∏—Å–∞–Ω–∏–∏ —Å—á–µ—Ç–∞ | –ó–∞–ø–∏—Å—å –∫–∞–∫ failed |
| -1 | –ß–µ—Ä–Ω–æ–≤–∏–∫ (–≤—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞) | –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º |
| 0 | –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã | –ñ–¥—ë–º –æ–ø–ª–∞—Ç—ã |
| 1 | –û–ø–ª–∞—á–µ–Ω ‚úÖ | **–ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–¥–ø–∏—Å–∫—É** |
| 2 | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω ‚úÖ | **–ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–¥–ø–∏—Å–∫—É** |

### HTTP –∫–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤ webhook'–∞

| –ö–æ–¥ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|-----|----------|
| 200 | OK - —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ |
| 201 | Created - —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ |
| 400 | Bad Request - –Ω–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| 403 | Forbidden - –Ω–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å |
| 404 | Not Found - –ø–ª–∞—Ç–µ–∂ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ë–î |
| 500 | Internal Error - –æ—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ |

---

## ‚ú® –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞ –≤—Ä—É—á–Ω—É—é

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞–∂–∞—Ç—å "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É" –µ—Å–ª–∏ –ø–ª–∞—Ç—ë–∂ –ø—Ä–æ—à—ë–ª, –Ω–æ webhook –Ω–µ –ø—Ä–∏—à—ë–ª (—Ä–µ–¥–∫–æ, –Ω–æ –º–æ–∂–µ—Ç —Å–ª—É—á–∏—Ç—å—Å—è):

```python
@router.callback_query(F.data == "check_oneplat_payment")
async def process_check_oneplat_payment(callback: CallbackQuery):
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ –≤—Ä—É—á–Ω—É—é"""
    # –ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∏–∑ 1Plat API
    # –ï—Å–ª–∏ –æ–ø–ª–∞—á–µ–Ω–æ - –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
sudo journalctl -u spn-bot -f

# –§–∏–ª—å—Ç—Ä –ø–æ 1Plat
sudo journalctl -u spn-bot -f | grep 1plat

# –§–∏–ª—å—Ç—Ä –ø–æ –æ—à–∏–±–∫–∞–º
sudo journalctl -u spn-bot -f | grep ERROR
```

---

## üéì –û–±—É—á–µ–Ω–∏–µ

### –ö–∞–∫ –ø–æ–Ω—è—Ç—å –∫–æ–¥

1. **–ù–∞—á–Ω–∏—Ç–µ —Å** `handlers/subscription.py`
   - –§—É–Ω–∫—Ü–∏—è `process_pay_1plat()` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
   - –§—É–Ω–∫—Ü–∏—è `process_pay_yookassa()` - –≤—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã

2. **–ó–∞—Ç–µ–º** `services/oneplat.py`
   - –§—É–Ω–∫—Ü–∏—è `create_oneplat_payment()` - API –∑–∞–ø—Ä–æ—Å
   - –§—É–Ω–∫—Ü–∏—è `verify_callback()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏

3. **–ó–∞—Ç–µ–º** `handlers/webhooks.py`
   - –§—É–Ω–∫—Ü–∏—è `handle_oneplat_webhook()` - –ø–æ–ª—É—á–µ–Ω–∏–µ callback'–∞

4. **–ò –Ω–∞–∫–æ–Ω–µ—Ü** `database.py`
   - –§—É–Ω–∫—Ü–∏—è `create_oneplat_payment()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
   - –§—É–Ω–∫—Ü–∏—è `update_payment_status_by_guid()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

### –ì–¥–µ —á—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è

| –ß—Ç–æ | –§–∞–π–ª | –§—É–Ω–∫—Ü–∏—è |
|-----|------|---------|
| –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ | handlers/subscription.py | process_pay_1plat() |
| API 1Plat | services/oneplat.py | create_oneplat_payment() |
| Webhook | handlers/webhooks.py | handle_oneplat_webhook() |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ | services/oneplat.py | verify_callback() |
| –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ | services/cryptobot.py | process_paid_invoice() |
| –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ | database.py | create_oneplat_payment() |

---

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ production

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≥–æ—Ç–æ–≤—ã:

‚úÖ Python –∫–æ–¥ (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω —Å–∏–Ω—Ç–∞–∫—Å–∏—Å)  
‚úÖ Database –º–∏–≥—Ä–∞—Ü–∏—è  
‚úÖ API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è 1Plat  
‚úÖ Webhook —Å–µ—Ä–≤–µ—Ä  
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–µ–π  
‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è  
‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã  
‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è  

---

## ‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –ù—É–∂–Ω–æ –ª–∏ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–π –∫–æ–¥ Yookassa?**  
A: –ù–µ—Ç, –æ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω—ë–Ω –≤ `handlers/subscription.py` (—Ñ—É–Ω–∫—Ü–∏—è `process_pay_yookassa`).

**Q: –ö–∞–∫–æ–π –ø–æ—Ä—Ç –¥–ª—è webhook'–∞?**  
A: **8080**. Nginx –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç `/1plat-webhook` –Ω–∞ —ç—Ç–æ—Ç –ø–æ—Ä—Ç.

**Q: –ß—Ç–æ –µ—Å–ª–∏ callback –Ω–µ –ø—Ä–∏—à—ë–ª?**  
A: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞–∂–∞—Ç—å "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É" –∏ –±–æ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç –≤ 1Plat API.

**Q: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ª–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø–ª–∞—Ç–µ–∂–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ?**  
A: –î–∞! –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å (async/await) –∏ –ø—É–ª –ë–î (5-20 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π).

**Q: –ù—É–∂–µ–Ω –ª–∏ ngrok –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è?**  
A: –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω.

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:** `sudo journalctl -u spn-bot -f`
2. **–ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:** [1PLAT_INTEGRATION.md](1PLAT_INTEGRATION.md)
3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç:** `python test_1plat_webhook.py 1`
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:** `nano .env`
5. **–ö–æ–Ω—Ç–∞–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏:** [–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ SUPPORT_URL]

---

## üéâ –ò—Ç–æ–≥–æ

**–ß—Ç–æ –±—ã–ª–æ:**
- –¢–æ–ª—å–∫–æ CryptoBot (–∫—Ä–∏–ø—Ç–æ–≤–∞–ª—É—Ç—ã)
- –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è Yookassa

**–ß—Ç–æ —Å—Ç–∞–ª–æ:**
- CryptoBot (–∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã)
- 1Plat (–∫–∞—Ä—Ç—ã + –°–ë–ü) ‚Üê –ù–û–í–û–ï!
- –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–ø–ª–∞—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Å–ø–æ—Å–æ–±–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ production —Å –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ–ø–ª–∞—Ç—ã!

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## –ê–≤—Ç–æ—Ä

Hamzat Yaudarov

## –í–µ—Ä—Å–∏—è

1.0.0 - 1Plat Payment Integration
