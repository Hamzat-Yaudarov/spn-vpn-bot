# üöÄ –ë–æ–ª—å—à–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ SPN VPN Bot ‚Äî –î–≤–æ–π–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ + 3X-UI

## –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
–Ø–Ω–≤–∞—Ä—å 2026

## –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. üìä –°–∏—Å—Ç–µ–º–∞ —Ç–∞—Ä–∏—Ñ–æ–≤ (config.py)
**–î–æ–±–∞–≤–ª–µ–Ω—ã –¥–≤–µ —Ä–∞–∑–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Ç–∞—Ä–∏—Ñ–æ–≤:**

#### –û–±—ã—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ (TARIFFS_REGULAR)
- 1 –º–µ—Å—è—Ü ‚Äî 100‚ÇΩ
- 3 –º–µ—Å—è—Ü–∞ ‚Äî 249‚ÇΩ
- 6 –º–µ—Å—è—Ü–µ–≤ ‚Äî 449‚ÇΩ
- 12 –º–µ—Å—è—Ü–µ–≤ ‚Äî 990‚ÇΩ

#### –û–±—ã—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ + –û–±—Ö–æ–¥ –≥–ª—É—à–∏–ª–æ–∫ (TARIFFS_ANTI_JAMMING)
- 1 –º–µ—Å—è—Ü ‚Äî 150‚ÇΩ
- 3 –º–µ—Å—è—Ü–∞ ‚Äî 349‚ÇΩ
- 6 –º–µ—Å—è—Ü–µ–≤ ‚Äî 599‚ÇΩ
- 12 –º–µ—Å—è—Ü–µ–≤ ‚Äî 1190‚ÇΩ

### 2. üîê 3X-UI –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (config.py)
–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å 3X-UI –ø–∞–Ω–µ–ª—å—é:
```
XUI_PANEL_URL = "https://51.250.117.234:2053"
XUI_PANEL_PATH = "/sXvL8myMex46uSa3NP/panel"
XUI_USERNAME = "U0UiUl76S0"
XUI_PASSWORD = "2W1SwoZ0Ix"
SUB_PORT = 2096
SUB_EXTERNAL_HOST = "51.250.117.234"
INBOUND_ID = 1
```

### 3. üíæ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ë–î (database.py)

**–ù–æ–≤—ã–µ —Å—Ç–æ–ª–±—Ü—ã –≤ —Ç–∞–±–ª–∏—Ü–µ `users`:**
- `subscription_type` (TEXT) ‚Äî —Ç–∏–ø –ø–æ–¥–ø–∏—Å–∫–∏: 'regular' –∏–ª–∏ 'anti_jamming'
- `balance` (NUMERIC) ‚Äî –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `xui_uuid` (TEXT) ‚Äî UUID –∫–ª–∏–µ–Ω—Ç–∞ –≤ 3X-UI
- `xui_username` (TEXT) ‚Äî –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ 3X-UI
- `xui_subscription_until` (TIMESTAMP) ‚Äî –¥–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è 3X-UI –ø–æ–¥–ø–∏—Å–∫–∏

**–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
- `get_balance()`, `add_balance()`, `subtract_balance()`, `set_balance()` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º
- `get_subscription_type()`, `set_subscription_type()` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–º –ø–æ–¥–ø–∏—Å–∫–∏
- `update_xui_subscription()`, `get_xui_subscription()`, `has_xui_subscription()` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3X-UI –ø–æ–¥–ø–∏—Å–∫–∞–º–∏

### 4. üîß –°–µ—Ä–≤–∏—Å 3X-UI (services/xui.py)

–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å 3X-UI API:
- `get_xui_session()` ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ 3X-UI
- `create_xui_client()` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –≤ 3X-UI
- `extend_xui_subscription()` ‚Äî –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ 3X-UI
- `get_xui_client_traffic()` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–∞—Ñ–∏–∫–µ

### 5. üéØ –°–æ—Å—Ç–æ—è–Ω–∏—è (states.py)

–î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- `UserStates.choosing_subscription_type` ‚Äî –≤—ã–±–æ—Ä —Ç–∏–ø–∞ –ø–æ–¥–ø–∏—Å–∫–∏

### 6. üí≥ –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–¥–ø–∏—Å–æ–∫ (handlers/subscription.py)

**–ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–¥–µ–ª–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–æ–∫—É–ø–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏:**

1. **–í—ã–±–æ—Ä —Ç–∏–ø–∞ –ø–æ–¥–ø–∏—Å–∫–∏** ‚Üí –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞:
   - üîê –û–±—ã—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ (—Ç–æ–ª—å–∫–æ Remnawave)
   - üõ°Ô∏è –û–±—ã—á–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ + –û–±—Ö–æ–¥ –≥–ª—É—à–∏–ª–æ–∫ (Remnawave + 3X-UI)

2. **–ü–æ–∫–∞–∑ —Ç–∞—Ä–∏—Ñ–æ–≤** ‚Üí –†–∞–∑–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞

3. **–í—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã** ‚Üí CryptoBot –∏–ª–∏ Yookassa

4. **–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏** ‚Üí –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞:
   - **regular**: —Å–æ–∑–¥–∞—ë—Ç –∫–ª–∏–µ–Ω—Ç–∞ —Ç–æ–ª—å–∫–æ –≤ Remnawave
   - **anti_jamming**: —Å–æ–∑–¥–∞—ë—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ Remnawave –ò –≤ 3X-UI

5. **–ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–¥–ø–∏—Å–∫–∏ (my_subscription)** ‚Üí –î–ª—è anti_jamming –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –æ–±–µ —Å—Å—ã–ª–∫–∏:
   - –°—Å—ã–ª–∫–∞ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (Remnawave)
   - –°—Å—ã–ª–∫–∞ –¥–ª—è –æ–±—Ö–æ–¥–∞ –≥–ª—É—à–∏–ª–æ–∫ (3X-UI)

### 7. üí∞ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π

**CryptoBot (services/cryptobot.py):**
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ `process_paid_invoice()` ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–æ–∏—Ö —Ç–∏–ø–æ–≤ –ø–æ–¥–ø–∏—Å–æ–∫
- –ü—Ä–∏ anti_jamming: —Å–æ–∑–¥–∞—é—Ç—Å—è –æ–±–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ (Remnawave + 3X-UI)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –æ–±–µ —Å—Å—ã–ª–∫–∏

**Yookassa (services/yookassa.py):**
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ `process_paid_yookassa_payment()` ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–æ–∏—Ö —Ç–∏–ø–æ–≤ –ø–æ–¥–ø–∏—Å–æ–∫
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ CryptoBot: —Å–æ–∑–¥–∞–Ω–∏–µ –¥–≤–æ–π–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –¥–ª—è anti_jamming

### 8. ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Å–æ–≤–º–µ—Å—Ç–∏–º—ã:
- **handlers/gift.py** ‚Äî –≤—ã–¥–∞—ë—Ç 3 –¥–Ω—è Remnawave –ø–æ–¥–ø–∏—Å–∫–∏
- **handlers/promo.py** ‚Äî –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø—Ä–æ–º–æ–∫–æ–¥—ã (–¥–æ–±–∞–≤–ª—è–µ—Ç –¥–Ω–∏ –∫ Remnawave)
- **handlers/referral.py** ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Ç–æ–∫–∞ –ø–ª–∞—Ç–µ–∂–∞

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–∏–ø –ø–æ–¥–ø–∏—Å–∫–∏
    ‚Üì
–ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–∞—Ä–∏—Ñ—ã (regular –∏–ª–∏ anti_jamming)
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–∞—Ä–∏—Ñ –∏ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã
    ‚Üì
–°–æ–∑–¥–∞—ë—Ç—Å—è —Å—á—ë—Ç/–ø–ª–∞—Ç—ë–∂ –≤ —Å–∏—Å—Ç–µ–º–µ –æ–ø–ª–∞—Ç—ã
    ‚Üì
–ü–ª–∞—Ç—ë–∂ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω
    ‚Üì
IF type == 'regular':
    - –°–æ–∑–¥–∞—ë–º –∫–ª–∏–µ–Ω—Ç–∞ –≤ Remnawave
    - –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–∫–≤–∞–¥
    - –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É –ø–æ–¥–ø–∏—Å–∫–∏
ELSE (type == 'anti_jamming'):
    - –°–æ–∑–¥–∞—ë–º –∫–ª–∏–µ–Ω—Ç–∞ –≤ Remnawave
    - –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–∫–≤–∞–¥
    - –°–æ–∑–¥–∞—ë–º –∫–ª–∏–µ–Ω—Ç–∞ –≤ 3X-UI
    - –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±–µ —Å—Å—ã–ª–∫–∏ (Remnawave + 3X-UI)
    ‚Üì
–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ ‚úÖ
```

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

‚ö†Ô∏è **–í–∞–∂–Ω–æ –¥–ª—è —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è:**

1. –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —á–µ—Ä–µ–∑ `run_migrations()`)

2. –ù–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è):
   ```
   XUI_PANEL_URL
   XUI_PANEL_PATH
   XUI_USERNAME
   XUI_PASSWORD
   SUB_PORT
   SUB_EXTERNAL_HOST
   INBOUND_ID
   ```

3. –¢–µ–∫—É—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ `subscription_type = 'regular'` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

4. –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ ‚Äî —Å—Ç–∞—Ä—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
- ‚úÖ –í—ã–±–æ—Ä —Ç–∏–ø–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –≤ –±–æ—Ç–µ
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –≤ Remnawave –¥–ª—è regular
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –≤ Remnawave –ò 3X-UI –¥–ª—è anti_jamming
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –ø–æ–¥–ø–∏—Å–∫–∏
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–¥–ø–∏—Å–∫–∏ (my_subscription) ‚Äî –æ–±–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è anti_jamming
- ‚úÖ –†–∞–±–æ—Ç–∞ —Å –ø—Ä–æ–º–æ–∫–æ–¥–∞–º–∏ –∏ –ø–æ–¥–∞—Ä–∫–∞–º–∏
- ‚úÖ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞

## –§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã

1. **config.py** ‚Äî —Ç–∞—Ä–∏—Ñ—ã –∏ 3X-UI –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
2. **database.py** ‚Äî –Ω–æ–≤—ã–µ —Å—Ç–æ–ª–±—Ü—ã, –º–∏–≥—Ä–∞—Ü–∏–∏, —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
3. **services/xui.py** ‚Äî –Ω–æ–≤—ã–π —Ñ–∞–π–ª —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π 3X-UI
4. **states.py** ‚Äî –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
5. **handlers/subscription.py** ‚Äî –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–¥–µ–ª–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–æ–∫—É–ø–∫–∏
6. **services/cryptobot.py** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Ö —Ç–∏–ø–æ–≤ –ø–æ–¥–ø–∏—Å–æ–∫
7. **services/yookassa.py** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Ö —Ç–∏–ø–æ–≤ –ø–æ–¥–ø–∏—Å–æ–∫
