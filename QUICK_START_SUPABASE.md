# ‚ö° 5 –®–ê–ì–û–í –ö SUPABASE (15 –º–∏–Ω—É—Ç)

---

## üìã –ü–ï–†–ï–î –ù–ê–ß–ê–õ–û–ú

–ù–∞–π–¥–∏ –≤ —ç—Ç–æ–º –ø–∏—Å—å–º–µ —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è:
- `SUPABASE_URL=https://rpzupbtpfcqnwlxzhndd.supabase.co`
- `SUPABASE_KEY=sb_publishable_rAPEhWLXaexhMaKBbOvg-A_Xo1tz12I`
- `DATABASE_URL=postgresql://postgres:PASSWORD@db.rpzupbtpfcqnwlxzhndd...`

---

## üöÄ –®–ê–ì 1Ô∏è‚É£ - –°–æ–∑–¥–∞—ë–º —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase (3 –º–∏–Ω—É—Ç—ã)

1. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ https://supabase.com/dashboard
2. **–í—ã–±–µ—Ä–∏ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç**
3. –ù–∞–∂–º–∏ **"SQL Editor"** –≤ –ª–µ–≤–æ–º –º–µ–Ω—é
4. –ù–∞–∂–º–∏ **"+ New Query"** –∏–ª–∏ **"New Query"**
5. **–°–∫–æ–ø–∏—Ä—É–π –≤–µ—Å—å —Ç–µ–∫—Å—Ç –∏–∑ —Ñ–∞–π–ª–∞ `schema.sql`**
   - –ï—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—à—å –ª–æ–∫–∞–ª—å–Ω–æ - –æ—Ç–∫—Ä–æ–π —Ñ–∞–π–ª –ø—Ä–æ–µ–∫—Ç–∞
   - –ï—Å–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ - —Å–∫–æ–ø–∏—Ä—É–π —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
6. **–í—Å—Ç–∞–≤—å –≤ –æ–∫–Ω–æ SQL Editor –Ω–∞ Supabase**
7. **–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É "Run"** (–∏–ª–∏ Ctrl+Enter)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£–≤–∏–¥–∏—à—å —Å–æ–æ–±—â–µ–Ω–∏–µ "Query completed successfully" ‚úÖ

---

## üîê –®–ê–ì 2Ô∏è‚É£ - –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—à—å DATABASE_URL (2 –º–∏–Ω—É—Ç—ã)

–¢–≤–æ–π DATABASE_URL –≤—ã–≥–ª—è–¥–∏—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:
```
postgresql://postgres:Khamzat2Jaradat5612@db.rpzupbtpfcqnwlxzhndd.supabase.co:5432/postgres
```

**–ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ:**
- ‚úÖ –ù–µ—Ç —Å–∏–º–≤–æ–ª–æ–≤ `<` –∏ `>`
- ‚úÖ –ï—Å—Ç—å –ø–æ—Ä—Ç `:5432`
- ‚úÖ –ï—Å—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å (–Ω–µ –∑–≤—ë–∑–¥–æ—á–∫–∏)
- ‚úÖ –ü–æ—Å–ª–µ `supabase.co` –¥–≤–∞ –¥–≤–æ–µ—Ç–æ—á–∏—è `:`

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫ - –ø–æ—Å–º–æ—Ç—Ä–∏ –≤ Supabase Dashboard ‚Üí Project Settings ‚Üí Database ‚Üí Connection pooling

---

## üìù –®–ê–ì 3Ô∏è‚É£ - –û–±–Ω–æ–≤–ª—è–µ—à—å .env –Ω–∞ VPS (3 –º–∏–Ω—É—Ç—ã)

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ VPS
ssh root@–í–ê–®_IP_–ê–î–†–ï–°

# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—à—å .env
nano /root/spn-vpn-bot/.env
```

**–î–æ–±–∞–≤—å —ç—Ç–∏ —Å—Ç—Ä–æ–∫–∏ –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞:**
```env
SUPABASE_URL=https://rpzupbtpfcqnwlxzhndd.supabase.co
SUPABASE_KEY=sb_publishable_rAPEhWLXaexhMaKBbOvg-A_Xo1tz12I
DATABASE_URL=postgresql://postgres:Khamzat2Jaradat5612@db.rpzupbtpfcqnwlxzhndd.supabase.co:5432/postgres
```

**(–ü–æ–¥—Å—Ç–∞–≤—å –°–í–û–ò –∑–Ω–∞—á–µ–Ω–∏—è!)**

**–£–¥–∞–ª–∏ —ç—Ç—É —Å—Ç—Ä–æ–∫—É –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å:**
```
DB_FILE=spn_vpn_bot.db
```

**–°–æ—Ö—Ä–∞–Ω–∏ —Ñ–∞–π–ª:**
- –ù–∞–∂–º–∏ **Ctrl+O**
- –ù–∞–∂–º–∏ **Enter**
- –ù–∞–∂–º–∏ **Ctrl+X**

**–ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å:**
```bash
cat /root/spn-vpn-bot/.env | grep DATABASE_URL
# –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ —Ç–≤–æ–π DATABASE_URL
```

---

## üì¶ –®–ê–ì 4Ô∏è‚É£ - –û–±–Ω–æ–≤–ª—è–µ—à—å –ø—Ä–æ–µ–∫—Ç (3 –º–∏–Ω—É—Ç—ã)

```bash
# –ü–µ—Ä–µ—Ö–æ–¥–∏—à—å –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd /root/spn-vpn-bot

# –°–∫–∞—á–∏–≤–∞–µ—à—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
git pull origin main

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ—à—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source venv/bin/activate

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—à—å –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt --upgrade

# –í—ã—Ö–æ–¥–∏—à—å –∏–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
deactivate
```

---

## üöÄ –®–ê–ì 5Ô∏è‚É£ - –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—à—å –±–æ—Ç–∞ (2 –º–∏–Ω—É—Ç—ã)

```bash
# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—à—å —Å–µ—Ä–≤–∏—Å
sudo systemctl restart spn-bot

# –ü—Ä–æ–≤–µ—Ä—è–µ—à—å —Å—Ç–∞—Ç—É—Å
sudo systemctl status spn-bot
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:**
```
‚óè spn-bot.service - SPN VPN Bot
    Loaded: loaded
    Active: active (running)  ‚Üê –≠–¢–û –•–û–†–û–®–û!
```

**–ï—Å–ª–∏ –≤–∏–¥–∏—à—å "active (running)" - –í–°–ï –†–ê–ë–û–¢–ê–ï–¢! ‚úÖ**

---

## üîç –ü–†–û–í–ï–†–ö–ê (30 —Å–µ–∫—É–Ω–¥)

```bash
# –°–º–æ—Ç—Ä–∏—à—å –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
sudo journalctl -u spn-bot -f
```

**–ò—â–µ—à—å —ç—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
‚úÖ "Database pool initialized successfully"
‚úÖ "All handlers registered"
‚úÖ "Bot started polling..."
```

**–ï—Å–ª–∏ –≤–∏–¥–∏—à—å —ç—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è - –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç! üéâ**

–ù–∞–∂–º–∏ **Ctrl+C** —á—Ç–æ–±—ã –≤—ã–π—Ç–∏ –∏–∑ –ª–æ–≥–æ–≤.

---

## ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –ß–ï–ö

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ—à—å —á—Ç–æ .env –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
cat /root/spn-vpn-bot/.env

# –î–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å:
# SUPABASE_URL=...
# SUPABASE_KEY=...
# DATABASE_URL=...
```

---

## üÜò –ï–°–õ–ò –ß–¢–û-–¢–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢

### –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –°–º–æ—Ç—Ä–∏—à—å –æ—à–∏–±–∫—É –≤ –ª–æ–≥–∞—Ö
sudo journalctl -u spn-bot -n 50 | tail -20

# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø—Ä–æ "Connection refused":
# 1. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ DATABASE_URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
# 2. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã –≤ Supabase (schema.sql)
# 3. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ IP VPS –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –≤ Supabase
```

### –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å IP VPS –∫ whitelist Supabase

```
–ü–µ—Ä–µ–π–¥–∏:
https://supabase.com/dashboard
‚Üí Project Settings
‚Üí Database
‚Üí Firewall rules
‚Üí Add IPv4 address ‚Üí –í–≤–µ–¥–∏ IP VPS (–µ–≥–æ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –ø–æ `curl ifconfig.me`)
```

### –¢–∞–±–ª–∏—Ü—ã –Ω–µ —Å–æ–∑–¥–∞–Ω—ã

```
–ü–µ—Ä–µ–π–¥–∏ –Ω–∞ https://supabase.com/dashboard
SQL Editor ‚Üí New Query
–°–∫–æ–ø–∏—Ä—É–π –≤–µ—Å—å –∫–æ–¥ –∏–∑ schema.sql
–í—Å—Ç–∞–≤—å –∏ –Ω–∞–∂–º–∏ Run
```

---

## üìä –ì–û–¢–û–í–û! üéâ

–¢–≤–æ–π –±–æ—Ç —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
- ‚úÖ **PostgreSQL** –≤–º–µ—Å—Ç–æ SQLite
- ‚úÖ **Supabase** –≤ –æ–±–ª–∞–∫–µ –≤–º–µ—Å—Ç–æ VPS
- ‚úÖ **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã**
- ‚úÖ **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î

**–í—Å—ë –≥–æ—Ç–æ–≤–æ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é! üöÄ**

---

## üí° –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. –¢–µ—Å—Ç–∏—Ä—É–µ—à—å –±–æ—Ç–∞ –≤ Telegram (`/start`, `/my_subscription` –∏ —Ç.–¥.)
2. –ü—Ä–æ–≤–µ—Ä—è–µ—à—å —á—Ç–æ –ø–ª–∞—Ç–µ–∂–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
3. –°–º–æ—Ç—Ä–∏—à—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Supabase Dashboard (—Ç–∞–º –≤–∏–¥–Ω—ã –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ø–ª–∞—Ç–µ–∂–∏, –ø—Ä–æ–º–æ–∫–æ–¥—ã)

**–í–æ–ø—Ä–æ—Å—ã?** –°–º–æ—Ç—Ä–∏ –ø–æ–ª–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ —Ñ–∞–π–ª–µ **SUPABASE_MIGRATION.md**
